# JPA 살펴보기

## 라이브러리
- 의존관계 확인
  - ./gradlew dependencies
- 핵심 라이브러리
  - 스프링 MVC
  - 스프링 ORM
  - JPA, 하이버네이트
  - 스프링 데이터 JPA
- 기타라이브러리
  - H2
  - HikariCP : 커넥션 풀
  - 타임리프
  - 로깅
  - 테스트
  - implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6' 
    - ? ? 파라미터 확인 (쿼리)

## java jar 사용하여 확인하기
1. ./gradlew clean build
2. cd bulid
3. java -jar ~~.jar

## 요구사항 분석
> 기능목록

- 회원 기능
  - 등록
  - 조회
- 상품 기능
  - 등록
  - 수정
  - 조회
- 주문 기능
  - 상품 주문
  - 주문내역 조회
  - 주문 취소
- 기타
  - 상품은 제고 관리가 필요
  - 상품 종류 도서 음반 영화
  - 상품 카테고리로 구분
  - 상품 주문 시 배송 정보 입력

## 참고사항
- 외래키가 있는곳을 연관관계 주인으로 설정
  - 연관관계의 주인은 단순히 외래 키를 누가 관리햐냐의 문제이다.
  - 일:다 관계에서는 다 쪽에 외래키가 있으므로 그렇게 정하면 된다.
- 엔티티 설계시 주의점
  - setter 사용하지말자. => 변경 포인트가 많아 유지보수가 어렵다.
  - 모든 연관관계는 지연로딩으로 설정
    - 즉시로딩은 예측이 어렵고, 어떤 SQL이 실행될지 추적이 어렵다. 특히 N+1 문제가 발생
    - 즉시로딩으로 해놓으면 연관된 객체들에 관한 쿼리가 다 나간다.
    - 연관된 엔티티를 함께 조회하면, fetch join 또는 엔티티 그래프 기능을 사용한다.
    - XToOne -> 기본이 EAGER, 꼭 변경하자.
  - 컬렉션은 필드에서 초기화하자.
    - null에 안전
    - 하이버네이트는 엔티티를 영속화 할 때, 컬렉션을 감싸서 하이버네이트가 제공하는 내장 컬렉션으로 변경, 만약 임의로 생성했다면 하이버네티으 내부 메커니즘에 문제가 발생할 수 있다.
- id를 Long으로 하는 이유
  - int, long이 아닌 Wrapper Class(Long)를 쓰는 이유는 null을 사용할 수 있기 때문입니다. primitive type은 기본값이 0이 되는데, id가 없을 때를 나타낼 수 없습니다.
  - Long과 Integer 중에서 Long을 쓰는 이유는 표현범위 때문입니다.
  - Long이 Integer보다 월등히 많은 수를 표현할 수 있기 때문에 Long을 사용합니다.
  - 물론 Integer의 범위로도 충분하다면 Integer를 사용하셔도 무방합니다.

## 메모리 디비(스프링 부트 지원)
- 테스트 시 자동으로 jdbc:h2:mem:test로 커넥션을 얻어온다.